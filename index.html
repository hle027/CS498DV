<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<div class="a">
<p><b>Covid-19 Cases in the US</b></p>
</div>
<!-- Create a div where the graph will take place -->
<div id="plot"></div>

<style>
.bubbles {
  stroke-width: 2px;
  stroke: white;
}
.bubbles:hover {
  stroke: black;
}
</style>

<script>

// set the dimensions and margins of the graph
var margin = {top: 40, right: 80, bottom: 100, left: 200},
    width = 1200 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#plot")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read the data
d3.csv("https://raw.githubusercontent.com/hle027/CS498DV/master/us-states.csv", function(data) {

  // Add X axis
  var x = d3.scaleLog()
    .domain([10, 1000000])
    .range([ 0, width ]);
    
  var x_axis = d3.axisBottom(x).ticks(5).tickFormat(d3.format(".0s")); 
    
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(x_axis);
  //svg.append("g")
    //.attr("transform", "translate(0," + height + ")")
    //call(d3.axisBottom(x));
  svg.append("text")
      .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (height + margin.top) + ")")
      .style("text-anchor", "middle")
	    .style("font", "20px times")
      .text("Confirmed Cases");
  // Add Y axis
  var y = d3.scaleLog()
    .domain([1, 20000])
    .range([ height, 0]);
    
  var y_axis = d3.axisLeft(y).ticks(4).tickFormat(d3.format(".0s"));  	
    
  svg.append("g")
    .call(y_axis);
  svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", margin.left - margin.left - margin.right)
      .attr("x",0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
	    .style("font", "20px times")
      .text("Total Deaths")
  
  var z = d3.scaleSqrt()
    .domain([100, 4500000])
    .range([ 5, 40]); 
  
  var Color = d3.scaleOrdinal()
    .domain(["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Guam", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Northern Mariana Islands", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Puerto Rico", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virgin Islands", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"])
    .range(["#046e0e", "#6f18ff", "#b91346", "#0c5fab", "#ab049f", "#695c4f", "#944b01", "#0b50e2", "#8f4477", "#636105", "#be0e02", "#01677c", "#0d6b4e", "#7249ab", "#924844", "#8a27ce", "#b50972", "#605a7d", "#a9362a", "#7d5727", "#1458c6", "#506534", "#4e3df0", "#9d318b", "#a6325e", "#645497", "#805063", "#3c665c", "#6944c7", "#8f30b2", "#2f6190", "#2f6b2b", "#416901", "#565f69", "#ab3508", "#bc102c", "#914b28", "#a63745", "#834691", "#6a5e34", "#8617e3", "#7e5543", "#9e13b9", "#994157", "#633edb", "#7a5909", "#576248", "#3b59b2", "#3f50cd", "#7b4f7d", "#8f399e",, "#FDAE61", "#F46D43", "#66C2A5", "#1BDDF4"]);
	
  var tooltip = d3.select("#plot")
    .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "black")
      .style("border-radius", "5px")
      .style("padding", "10px")
      .style("color", "white")

  // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
  var showTooltip = function(d) {
    tooltip
      .transition()
      .duration(200)
    tooltip
      .style("opacity", 1)
      .html("State: " + d.state +
	  "<br />" + "Confirmed Cases: " + d.cases + 
	  "<br />" + "Total Deaths: " + d.deaths)
      .style("left", (d3.mouse(this)[0]+30) + "px")
      .style("top", (d3.mouse(this)[1]+30) + "px")
  }
  var moveTooltip = function(d) {
    tooltip
      .style("left", (d3.mouse(this)[0]+30) + "px")
      .style("top", (d3.mouse(this)[1]+30) + "px")
  }
  var hideTooltip = function(d) {
    tooltip
      .transition()
      .duration(200)
      .style("opacity", 0)
  }

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("class", "bubbles")
      .attr("cx", function (d) { return x(d.cases); } )
      .attr("cy", function (d) { return y(d.deaths); } )
      //.attr("r", function (d) { return z(d.pop); } )
      .attr("r",5)
      .style("fill", function (d) { return Color(d.state); } )
    // -3- Trigger the functions
    .on("mouseover", showTooltip )
    .on("mousemove", moveTooltip )
    .on("mouseleave", hideTooltip )	
	
	
	// Add dots
 // svg.append('g')
   // .selectAll("dot")
   // .data(data)
   // .enter()
  //  .append("circle")
    //  .attr("cx", function (d) { return x(d.cases); } )
    //  .attr("cy", function (d) { return y(d.deaths); } )
    //  .attr("r", 5)
    //  .style("fill", "#69b3a2")

})

</script>
